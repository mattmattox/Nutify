{% extends "dashboard/base.html" %}

{% block content %}


<div class="page">

    <!-- Tabs Navigation -->
    <div class="options_tabs">
        {% if user_is_admin or user_options_tabs.get('email', False) %}
        <button class="options_tab_button active" data-tab="email">
            <i class="fas fa-envelope"></i>
            Email Configuration
        </button>
        {% endif %}
        {% if user_is_admin or user_options_tabs.get('extranotifs', False) %}
        <button class="options_tab_button" data-tab="Extranotifs">
            <i class="fas fa-sliders-h"></i>
            Extranotifs
        </button>
        {% endif %}
        {% if user_is_admin or user_options_tabs.get('webhook', False) %}
        <button class="options_tab_button" data-tab="Webhook">
            <i class="fas fa-globe"></i>
            Webhook
        </button>
        {% endif %}
        {% if user_is_admin or user_options_tabs.get('powerflow', False) %}
        <button class="options_tab_button" data-tab="variables">
            <i class="fas fa-sliders-h"></i>
            PowerFlow
        </button>
        {% endif %}
        {% if user_is_admin or user_options_tabs.get('database', False) %}
        <button class="options_tab_button" data-tab="Database">
            <i class="fas fa-database"></i>
            Database
        </button>
        {% endif %}
        {% if user_is_admin or user_options_tabs.get('log', False) %}
        <button class="options_tab_button" data-tab="Log">
            <i class="fas fa-box"></i>
            Log
        </button>
        {% endif %}
        {% if user_is_admin or user_options_tabs.get('advanced', False) %}
        <button class="options_tab_button" data-tab="Advanced">
            <i class="fas fa-cogs"></i>
            Advanced
        </button>
        {% endif %}
        {% if user_is_admin or user_options_tabs.get('admin', False) %}
        <button class="options_tab_button" data-tab="Admin">
            <i class="fas fa-user-shield"></i>
            Admin
        </button>
        {% endif %}
        <button class="options_tab_button" data-tab="About">
            <i class="fas fa-home-user"></i>
            About
        </button>
    </div>

    <!-- Email Configuration Tab -->
    {% if user_is_admin or user_options_tabs.get('email', False) %}
    <div class="options_tab_content active" id="email_tab">
        <!-- Add Configuration Button -->
        <div class="options_card" id="addEmailConfigContainer">
            <div class="card_header">
                <div class="notification_header">
                    <h2>Email Configuration</h2>
                    <button type="button" id="addEmailConfigBtn" class="options_btn">
                        <i class="fas fa-plus"></i> Add Configuration
                    </button>
                </div>
                <p class="card_subtitle">Configure email settings for notifications</p>
            </div>
        </div>
        
        <div class="options_card" id="emailConfigFormCard" style="display: none;">
            <div class="card_header">
                <div class="notification_header">
                    <h2>Email Configuration</h2>
                    <div class="options_mail_form_group" style="margin: 0;">
                        <select id="email_provider" name="email_provider" class="form-select">
                            <option value="">Custom Configuration</option>
                        </select>
                    </div>
                </div>
                <p class="card_subtitle">Configure email settings for notifications</p>
            </div>

            <form id="emailConfigForm">
                <!-- Hidden field for configuration ID -->
                <input type="hidden" id="email_config_id" name="email_config_id">
                
                <!-- Custom Provider Name - will only be visible when "Custom Configuration" is selected -->
                <div id="custom_provider_container" style="display: none; max-width: 800px; margin-bottom: 15px;">
                    <div class="options_mail_form_group">
                        <label for="custom_provider_name"><i class="fas fa-tag"></i> <span>Name Provider</span></label>
                        <input type="text" id="custom_provider_name" name="custom_provider_name" placeholder="e.g. My Custom Email Provider">
                    </div>
                </div>
                
                <div class="options_mail_form_grid">
                    <!-- First row -->
                    <div class="options_mail_form_group">
                        <label for="smtp_server"><i class="fas fa-server"></i> <span id="smtp_server_label">SMTP Server</span></label>
                        <input type="text" id="smtp_server" name="smtp_server" placeholder="e.g. smtp.gmail.com" required>
                    </div>

                    <div class="options_mail_form_group">
                        <label for="smtp_port"><i class="fas fa-network-wired"></i> <span id="smtp_port_label">SMTP Port</span></label>
                        <input type="number" id="smtp_port" name="smtp_port" placeholder="e.g. 587" required>
                    </div>

                    <div class="options_mail_form_group">
                        <div class="checkbox-container">
                            <input type="checkbox" id="use_tls" name="use_tls">
                            <label for="use_tls"><i class="fas fa-lock"></i> Use TLS/SSL</label>
                        </div>
                    </div>
                    
                    <!-- Provider Notes - Moved outside the grid for better layout -->
                </div>
                

                
                <div class="options_mail_form_grid">
                    <!-- Second row -->
                    <div class="options_mail_form_group">
                        <label for="smtp_username"><i class="fas fa-user-shield"></i> <span id="username_label">Username</span></label>
                        <input type="text" id="smtp_username" name="smtp_username" required>
                    </div>

                    <div class="options_mail_form_group">
                        <label for="smtp_password"><i class="fas fa-key"></i> <span id="password_label">Password</span></label>
                        <input type="password" id="smtp_password" name="smtp_password" 
                               autocomplete="new-password"
                               placeholder="*************">
                    </div>
                    
                    <div class="options_mail_form_group">
                        <div class="checkbox-container">
                            <input type="checkbox" id="use_starttls" name="use_starttls">
                            <label for="use_starttls"><i class="fas fa-shield-alt"></i> Use STARTTLS</label>
                        </div>
                    </div>
                </div>
                
                <div class="options_mail_form_grid">
                    <!-- Third row - From Email and Test Email recipient -->
                    <div class="options_mail_form_group">
                        <label for="from_email"><i class="fas fa-envelope"></i> <span id="from_email_label">From Email</span></label>
                        <input type="email" id="from_email" name="from_email" placeholder="Sender email address">
                    </div>
                    
                    <div class="options_mail_form_group">
                        <label for="to_email"><i class="fas fa-paper-plane"></i> Email to send Test Email and Notifications</label>
                        <input type="email" id="to_email" name="to_email" placeholder="Email address for receiving test emails and notifications">
                    </div>
                </div>

                <!-- Provider Notes -->
                <div id="provider_notes" class="provider-notes-container" style="display: none; margin-bottom: 20px;">
                    <i class="fas fa-info-circle"></i> <span class="provider-notes-text"></span>
                </div>

                <!-- Fourth row - Buttons -->
                <div class="options_mail_buttons">
                    <button type="button" id="testEmailBtn" class="options_btn">
                        <i class="fas fa-paper-plane"></i>
                        <span class="btn-text">Test Email</span>
                        <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                    </button>
                    <button type="button" id="saveEmailConfigBtn" class="options_btn">
                        <i class="fas fa-save"></i>
                        Save Configuration
                    </button>
                    <button type="button" id="cancelEmailConfigBtn" class="options_btn">
                        <i class="fas fa-times"></i>
                        Cancel
                    </button>
                </div>



                <div id="configurationStatus" class="options_mail_config_status hidden">
                    <p>Email configured successfully</p>
                    <p class="provider-info"></p>
                    <button type="button" id="reconfigureBtn">
                        <i class="fas fa-cog"></i>
                        Reconfigure
                    </button>
                </div>

                <div id="emailStatus" class="options_alert hidden"></div>
                <div id="lastTestInfo" class="options_mail_test_info"></div>
            </form>
        </div>
        
        <!-- Email Configuration Summary Card -->
        <div class="options_card mt-4" id="emailConfigSummary">
            <div class="card_header">
                <h2>Configured Emails</h2>
                <p class="card_subtitle">Your email configurations</p>
            </div>
            
            <div class="email_config_summary" id="emailConfigList">
                <!-- Email configurations will be listed here dynamically -->
            </div>
        </div>
        
        <!-- Sections that depend on Enable Email Notifications -->
        <div id="notification_dependent_sections">
            <!-- Email Notifications section -->
            <div class="options_card">
                <div class="card_header">
                    <div class="notification_header">
                        <h2>Email Notifications</h2>
                    </div>
                    <p class="card_subtitle">Configure which events should trigger email notifications</p>
                </div>
                <div id="options_nutify_status" class="options_alert hidden"></div>

                <div class="options_nutify_grid">
                    <!-- ONLINE notification -->
                    <div class="options_notification_card">
                        <div class="options_nutify_header">
                            <div class="options_nutify_icon">
                                <i class="fas fa-plug"></i>
                            </div>
                            <div class="options_nutify_title_container">
                                <span class="options_nutify_title">UPS on Line Power</span>
                                <span class="options_nutify_description">Notify when UPS returns to line power</span>
                            </div>
                            <button type="button" class="options_btn options_nutify_test" data-event-type="ONLINE">
                                <span class="btn-text">Test</span>
                                <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                            </button>
                            <div class="options_nutify_toggle">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="notify_online" class="options_nutify_checkbox toggle-input" data-event-type="ONLINE">
                                    <label for="notify_online" class="toggle-label">
                                        <span class="toggle-inner"></span>
                                        <span class="toggle-switch-text-on">ON</span>
                                        <span class="toggle-switch-text-off">OFF</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="options_nutify_body">
                            <select class="options_email_select" data-event-type="ONLINE">
                                <option value="">Select email</option>
                                <!-- Email options will be populated dynamically -->
                            </select>
                        </div>
                    </div>
                    
                    <!-- ONBATT notification -->
                    <div class="options_notification_card">
                        <div class="options_nutify_header">
                            <div class="options_nutify_icon">
                                <i class="fas fa-battery-half"></i>
                            </div>
                            <div class="options_nutify_title_container">
                                <span class="options_nutify_title">UPS on Battery</span>
                                <span class="options_nutify_description">Notify when UPS switches to battery power</span>
                            </div>
                            <button type="button" class="options_btn options_nutify_test" data-event-type="ONBATT">
                                <span class="btn-text">Test</span>
                                <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                            </button>
                            <div class="options_nutify_toggle">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="notify_onbatt" class="options_nutify_checkbox toggle-input" data-event-type="ONBATT">
                                    <label for="notify_onbatt" class="toggle-label">
                                        <span class="toggle-inner"></span>
                                        <span class="toggle-switch-text-on">ON</span>
                                        <span class="toggle-switch-text-off">OFF</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="options_nutify_body">
                            <select class="options_email_select" data-event-type="ONBATT">
                                <option value="">Select email</option>
                                <!-- Email options will be populated dynamically -->
                            </select>
                        </div>
                    </div>
                    
                    <!-- LOWBATT notification -->
                    <div class="options_notification_card">
                        <div class="options_nutify_header">
                            <div class="options_nutify_icon">
                                <i class="fas fa-battery-empty"></i>
                            </div>
                            <div class="options_nutify_title_container">
                                <span class="options_nutify_title">Low Battery</span>
                                <span class="options_nutify_description">Notify when battery is running low</span>
                            </div>
                            <button type="button" class="options_btn options_nutify_test" data-event-type="LOWBATT">
                                <span class="btn-text">Test</span>
                                <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                            </button>
                            <div class="options_nutify_toggle">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="notify_lowbatt" class="options_nutify_checkbox toggle-input" data-event-type="LOWBATT">
                                    <label for="notify_lowbatt" class="toggle-label">
                                        <span class="toggle-inner"></span>
                                        <span class="toggle-switch-text-on">ON</span>
                                        <span class="toggle-switch-text-off">OFF</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="options_nutify_body">
                            <select class="options_email_select" data-event-type="LOWBATT">
                                <option value="">Select email</option>
                                <!-- Email options will be populated dynamically -->
                            </select>
                        </div>
                    </div>
                    
                    <!-- COMMOK notification -->
                    <div class="options_notification_card">
                        <div class="options_nutify_header">
                            <div class="options_nutify_icon">
                                <i class="fas fa-wifi"></i>
                            </div>
                            <div class="options_nutify_title_container">
                                <span class="options_nutify_title">Communication Restored</span>
                                <span class="options_nutify_description">Notify when UPS communication is restored</span>
                            </div>
                            <button type="button" class="options_btn options_nutify_test" data-event-type="COMMOK">
                                <span class="btn-text">Test</span>
                                <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                            </button>
                            <div class="options_nutify_toggle">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="notify_commok" class="options_nutify_checkbox toggle-input" data-event-type="COMMOK">
                                    <label for="notify_commok" class="toggle-label">
                                        <span class="toggle-inner"></span>
                                        <span class="toggle-switch-text-on">ON</span>
                                        <span class="toggle-switch-text-off">OFF</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="options_nutify_body">
                            <select class="options_email_select" data-event-type="COMMOK">
                                <option value="">Select email</option>
                                <!-- Email options will be populated dynamically -->
                            </select>
                        </div>
                    </div>
                    
                    <!-- COMMBAD notification -->
                    <div class="options_notification_card">
                        <div class="options_nutify_header">
                            <div class="options_nutify_icon">
                                <i class="fas fa-times-circle"></i>
                            </div>
                            <div class="options_nutify_title_container">
                                <span class="options_nutify_title">Communication Lost</span>
                                <span class="options_nutify_description">Notify when UPS communication is lost</span>
                            </div>
                            <button type="button" class="options_btn options_nutify_test" data-event-type="COMMBAD">
                                <span class="btn-text">Test</span>
                                <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                            </button>
                            <div class="options_nutify_toggle">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="notify_commbad" class="options_nutify_checkbox toggle-input" data-event-type="COMMBAD">
                                    <label for="notify_commbad" class="toggle-label">
                                        <span class="toggle-inner"></span>
                                        <span class="toggle-switch-text-on">ON</span>
                                        <span class="toggle-switch-text-off">OFF</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="options_nutify_body">
                            <select class="options_email_select" data-event-type="COMMBAD">
                                <option value="">Select email</option>
                                <!-- Email options will be populated dynamically -->
                            </select>
                        </div>
                    </div>
                    
                    <!-- SHUTDOWN notification -->
                    <div class="options_notification_card">
                        <div class="options_nutify_header">
                            <div class="options_nutify_icon">
                                <i class="fas fa-power-off"></i>
                            </div>
                            <div class="options_nutify_title_container">
                                <span class="options_nutify_title">Shutdown Imminent</span>
                                <span class="options_nutify_description">Notify when system shutdown is about to start</span>
                            </div>
                            <button type="button" class="options_btn options_nutify_test" data-event-type="SHUTDOWN">
                                <span class="btn-text">Test</span>
                                <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                            </button>
                            <div class="options_nutify_toggle">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="notify_shutdown" class="options_nutify_checkbox toggle-input" data-event-type="SHUTDOWN">
                                    <label for="notify_shutdown" class="toggle-label">
                                        <span class="toggle-inner"></span>
                                        <span class="toggle-switch-text-on">ON</span>
                                        <span class="toggle-switch-text-off">OFF</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="options_nutify_body">
                            <select class="options_email_select" data-event-type="SHUTDOWN">
                                <option value="">Select email</option>
                                <!-- Email options will be populated dynamically -->
                            </select>
                        </div>
                    </div>
                    
                    <!-- REPLBATT notification -->
                    <div class="options_notification_card">
                        <div class="options_nutify_header">
                            <div class="options_nutify_icon">
                                <i class="fas fa-battery-full"></i>
                            </div>
                            <div class="options_nutify_title_container">
                                <span class="options_nutify_title">Replace Battery</span>
                                <span class="options_nutify_description">Notify when battery needs replacement</span>
                            </div>
                            <button type="button" class="options_btn options_nutify_test" data-event-type="REPLBATT">
                                <span class="btn-text">Test</span>
                                <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                            </button>
                            <div class="options_nutify_toggle">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="notify_replbatt" class="options_nutify_checkbox toggle-input" data-event-type="REPLBATT">
                                    <label for="notify_replbatt" class="toggle-label">
                                        <span class="toggle-inner"></span>
                                        <span class="toggle-switch-text-on">ON</span>
                                        <span class="toggle-switch-text-off">OFF</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="options_nutify_body">
                            <select class="options_email_select" data-event-type="REPLBATT">
                                <option value="">Select email</option>
                                <!-- Email options will be populated dynamically -->
                            </select>
                        </div>
                    </div>

                    <!-- NOCOMM notification -->
                    <div class="options_notification_card">
                        <div class="options_nutify_header">
                            <div class="options_nutify_icon">
                                <i class="fas fa-wifi-slash"></i>
                            </div>
                            <div class="options_nutify_title_container">
                                <span class="options_nutify_title">No Communication</span>
                                <span class="options_nutify_description">Notify when UPS is not reachable</span>
                            </div>
                            <button type="button" class="options_btn options_nutify_test" data-event-type="NOCOMM">
                                <span class="btn-text">Test</span>
                                <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                            </button>
                            <div class="options_nutify_toggle">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="notify_nocomm" class="options_nutify_checkbox toggle-input" data-event-type="NOCOMM">
                                    <label for="notify_nocomm" class="toggle-label">
                                        <span class="toggle-inner"></span>
                                        <span class="toggle-switch-text-on">ON</span>
                                        <span class="toggle-switch-text-off">OFF</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="options_nutify_body">
                            <select class="options_email_select" data-event-type="NOCOMM">
                                <option value="">Select email</option>
                                <!-- Email options will be populated dynamically -->
                            </select>
                        </div>
                    </div>

                    <!-- NOPARENT notification -->
                    <div class="options_notification_card">
                        <div class="options_nutify_header">
                            <div class="options_nutify_icon">
                                <i class="fas fa-child"></i>
                            </div>
                            <div class="options_nutify_title_container">
                                <span class="options_nutify_title">Parent Process Lost</span>
                                <span class="options_nutify_description">Notify when parent process is lost</span>
                            </div>
                            <button type="button" class="options_btn options_nutify_test" data-event-type="NOPARENT">
                                <span class="btn-text">Test</span>
                                <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                            </button>
                            <div class="options_nutify_toggle">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="notify_noparent" class="options_nutify_checkbox toggle-input" data-event-type="NOPARENT">
                                    <label for="notify_noparent" class="toggle-label">
                                        <span class="toggle-inner"></span>
                                        <span class="toggle-switch-text-on">ON</span>
                                        <span class="toggle-switch-text-off">OFF</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="options_nutify_body">
                            <select class="options_email_select" data-event-type="NOPARENT">
                                <option value="">Select email</option>
                                <!-- Email options will be populated dynamically -->
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Report Settings section -->
            <div class="options_card mt-4">
                <h2>Report Settings</h2>
                <div id="report_status_container" class="options_alert hidden"></div>
                <div class="card_header">
                    <div class="notification_header">
                        <p class="options_notification_subtitle">Configure automated report delivery</p>
                        <div class="options_nutify_actions">
                            <button type="button" id="sendReportNow" class="options_btn">
                                <i class="fas fa-paper-plane"></i>
                                <span class="btn-text">Send Report Now</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="options_notification_form">
                    <!-- Report Types -->
                    <div class="options_form_group">
                        <label class="options_form_label">Report Types</label>
                        <div class="options_checkbox_group">
                            <div class="options_checkbox_item">
                                <input type="checkbox" id="energy_report" name="report_types" value="energy">
                                <label for="energy_report">Energy Report</label>
                            </div>
                            <div class="options_checkbox_item">
                                <input type="checkbox" id="battery_report" name="report_types" value="battery">
                                <label for="battery_report">Battery Report</label>
                            </div>
                            <div class="options_checkbox_item">
                                <input type="checkbox" id="power_report" name="report_types" value="power">
                                <label for="power_report">Power Report</label>
                            </div>
                            <div class="options_checkbox_item">
                                <input type="checkbox" id="voltage_report" name="report_types" value="voltage">
                                <label for="voltage_report">Voltage Report</label>
                            </div>
                            <div class="options_checkbox_item">
                                <input type="checkbox" id="events_report" name="report_types" value="events" class="form-checkbox">
                                <label for="events_report">Events Report</label>
                            </div>
                        </div>
                    </div>

                    <!-- Date Range -->
                    <div class="options_form_group">
                        <label class="options_form_label">Report Period</label>
                        <div class="options_date_inputs">
                            <div class="options_input_group">
                                <label for="report_from_date">From</label>
                                <input type="date" id="report_from_date" class="options_input">
                            </div>
                            <div class="options_input_group">
                                <label for="report_to_date">To</label>
                                <input type="date" id="report_to_date" class="options_input">
                            </div>
                        </div>
                    </div>

                    <!-- Email Selection -->
                    <div class="options_form_group">
                        <label class="options_form_label">Email Configuration</label>
                        <div class="options_input_group">
                            <select id="report_email_select" class="options_input">
                                <option value="">Select email</option>
                                <!-- Email options will be populated dynamically -->
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Report Scheduler section -->
            <div class="options_card mt-4">
                <h2>Report Scheduler</h2>
                <div class="card_header">
                    <div class="notification_header">
                        <p class="options_notification_subtitle">Schedule automated report delivery</p>
                        <div class="options_nutify_actions">
                            <button id="addSchedulerBtn" class="options_btn options_btn_primary">
                                <i class="fas fa-plus"></i> Add Schedule
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Existing schedules list -->
                <div id="schedulerList" class="scheduler-list">
                    <!-- Populated dynamically via JavaScript -->
                </div>
            </div>

            <!-- Modal to add/modify schedule -->
            <div id="scheduleModal" class="modal">
                <div class="modal-content options_card">
                    <div class="modal-header">
                        <h5 class="modal-title">Schedule Report</h5>
                        
                    </div>
                    <div class="modal-body">
                        <!-- Error Message -->
                        <div id="scheduleModalError" class="alert alert-danger" style="display: none;"></div>
                        
                        <!-- Hidden field to store the current schedule ID when editing -->
                        <input type="hidden" id="currentEditScheduleId" value="">
                        
                        <!-- Form Content -->
                        <div class="schedule-form">
                            <!-- Days Selection -->
                            <div class="form-group">
                                <label>Days</label>
                                <div class="days-selector">
                                    <button type="button" class="day-btn" data-day="0">Sun</button>
                                    <button type="button" class="day-btn" data-day="1">Mon</button>
                                    <button type="button" class="day-btn" data-day="2">Tue</button>
                                    <button type="button" class="day-btn" data-day="3">Wed</button>
                                    <button type="button" class="day-btn" data-day="4">Thu</button>
                                    <button type="button" class="day-btn" data-day="5">Fri</button>
                                    <button type="button" class="day-btn" data-day="6">Sat</button>
                                </div>
                            </div>

                            <!-- Time Selection -->
                            <div class="form-group">
                                <label for="scheduleTime">Time</label>
                                <input type="time" id="scheduleTime" class="schedule-input" required>
                            </div>

                            <!-- Report Types -->
                            <div class="form-group">
                                <label>Report Types</label>
                                <div class="report-types-grid">
                                    <label class="report-type-item">
                                        <input type="checkbox" name="report_types" value="energy">
                                        <span>Energy Report</span>
                                    </label>
                                    <label class="report-type-item">
                                        <input type="checkbox" name="report_types" value="battery">
                                        <span>Battery Report</span>
                                    </label>
                                    <label class="report-type-item">
                                        <input type="checkbox" name="report_types" value="power">
                                        <span>Power Report</span>
                                    </label>
                                    <label class="report-type-item">
                                        <input type="checkbox" name="report_types" value="voltage">
                                        <span>Voltage Report</span>
                                    </label>
                                    <label class="report-type-item">
                                        <input type="checkbox" name="report_types" value="events">
                                        <span>Events Report</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Report Period -->
                            <div class="form-group">
                                <label for="period_type">Report Period</label>
                                <select id="period_type" class="schedule-input">
                                    <option value="" selected>Select Report Period</option>
                                    <option value="yesterday">Yesterday (00:00 - 24:00)</option>
                                    <option value="last_week">Last Week (Mon-Sun)</option>
                                    <option value="last_month">Last Month</option>
                                    <option value="range">Select Range</option>
                                </select>
                            </div>

                            <!-- Date Range Selection (visible only when period_type is 'range') -->
                            <div id="dateRangeSelection" class="form-group" style="display: none;">
                                <div class="date-range-inputs" style="display: flex; justify-content: space-between; gap: 10px;">
                                    <div class="input-group" style="flex: 1;">
                                        <label for="rangeFromDate">From</label>
                                        <input type="date" id="rangeFromDate" class="schedule-input" style="width: 100%;">
                                    </div>
                                    <div class="input-group" style="flex: 1;">
                                        <label for="rangeToDate">To</label>
                                        <input type="date" id="rangeToDate" class="schedule-input" style="width: 100%;">
                                    </div>
                                </div>
                            </div>

                            <!-- Email -->
                            <div class="form-group">
                                <label for="scheduleEmail">Select Email</label>
                                <select id="scheduleEmail" class="options_input schedule-input">
                                    <option value="">Select email</option>
                                    <!-- Email options will be populated dynamically -->
                                </select>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="modal-actions">
                            <button type="button" id="cancelScheduleBtn" class="options_btn options_btn_secondary">
                                <i class="fas fa-times"></i>
                                Cancel
                            </button>
                            <button type="button" id="testScheduleBtn" class="options_btn options_btn_secondary">
                                <i class="fas fa-vial"></i>
                                Test Schedule
                            </button>
                            <button type="button" id="saveScheduleBtn" class="options_btn">
                                <i class="fas fa-save"></i>
                                Save Schedule
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Variables Tab -->
    {% if user_is_admin or user_options_tabs.get('powerflow', False) %}
    <div class="options_tab_content hidden" id="variables_tab">
        <div class="combined_card">
            <div class="card_header">
                <div class="notification_header">
                    <h2>PowerFlow</h2>
                    <div class="options_nutify_actions">
                        <button type="reset" class="options_btn options_btn_secondary" form="variablesConfigForm">
                            <i class="fas fa-undo"></i> Reset
                        </button>
                        <button type="submit" class="options_btn options_btn_primary" form="variablesConfigForm">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </div>
                <p class="card_subtitle">Configure energy costs and environmental settings</p>
            </div>

            <form id="variablesConfigForm">
                <div class="stats_grid">
                    <!-- Currency Settings -->
                    <div class="stat_card">
                        <div class="stat-icon">
                            <i id="currencyIcon" class="fas fa-euro-sign"></i>
                        </div>
                        <div class="stat-content">
                            <label for="currency">Currency</label>
                            <select id="currency" name="currency" required>
                                <option value="EUR">Euro (EUR)</option>
                                <option value="USD">US Dollar (USD)</option>
                                <option value="GBP">British Pound (GBP)</option>
                                <option value="JPY">Japanese Yen (JPY)</option>
                                <option value="AUD">Australian Dollar (AUD)</option>
                                <option value="CAD">Canadian Dollar (CAD)</option>
                                <option value="CHF">Swiss Franc (CHF)</option>
                                <option value="CNY">Chinese Yuan (CNY)</option>
                                <option value="INR">Indian Rupee (INR)</option>
                                <option value="NZD">New Zealand Dollar (NZD)</option>
                                <option value="BRL">Brazilian Real (BRL)</option>
                                <option value="RUB">Russian Ruble (RUB)</option>
                                <option value="KRW">South Korean Won (KRW)</option>
                                <option value="PLN">Polish Zloty (PLN)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Energy Cost -->
                    <div class="stat_card">
                        <div class="stat-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <div class="stat-content">
                            <label for="kwh_cost">Cost per kWh</label>
                            <div class="input-with-icon">
                                <input type="number" id="kwh_cost" name="kwh_cost" step="0.001" min="0" required>
                                <span id="currencySymbol">€</span>
                            </div>
                        </div>
                    </div>

                    <!-- CO2 Factor -->
                    <div class="stat_card">
                        <div class="stat-icon">
                            <i class="fas fa-leaf"></i>
                        </div>
                        <div class="stat-content">
                            <label for="co2_factor">CO₂ Factor</label>
                            <div class="input-with-icon">
                                <input type="number" id="co2_factor" name="co2_factor" step="0.001" min="0" required>
                                <span>kg/kWh</span>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- Status Alert -->
                <div id="variablesStatus" class="options_alert hidden"></div>
            </form>
        </div>
    </div>
    {% endif %}

    <!-- Database Tab -->
    {% if user_is_admin or user_options_tabs.get('database', False) %}
    <div class="options_tab_content hidden" id="Database_tab">
        <div class="combined_card">
            <div class="card_header">
                <h2>Database Status</h2>
                <p class="card_subtitle">Monitor and manage your database</p>
            </div>
            
            <div class="stats_grid">


                <div class="stat_card">
                    <div class="stat-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Database Size</div>
                        <div class="stat-value" id="dbSize">.</div>
                    </div>
                </div>
                


                


                <div class="stat_card">
                    <div class="stat-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Total Records</div>
                        <div class="stat-value" id="totalRecords"></div>
                    </div>
                </div>


                <div class="stat_card">
                    <div class="stat-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Last Write</div>
                        <div class="stat-value" id="lastWrite" style="font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;"></div>
                    </div>
                </div>
            </div>

            <!-- New section for database actions with 3 cards in a row -->
            <div class="stats_grid">
                <!-- Optimize Database Card -->
                <div class="stat_card">
                    <div class="stat-icon">
                        <i class="fas fa-bug-slash"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Optimize Database</div>
                        <p class="stat-description">Analyzes and reorganizes the database indexes to improve query performance.</p>
                        <button type="button" id="optimizeDbBtn" class="database_action_btn">
                            <i class="fas fa-wrench"></i> Optimize Database
                        </button>
                        <div id="databaseStatusOptimize" class="options_alert hidden"></div>
                    </div>
                </div>

                <!-- Vacuum Database Card -->
                <div class="stat_card">
                    <div class="stat-icon">
                        <i class="fas fa-compress-arrows-alt"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Vacuum Database</div>
                        <p class="stat-description">Removes unused space and defragments the database, reducing its physical size.</p>
                        <button type="button" id="vacuumDbBtn" class="database_action_btn">
                            <i class="fas fa-broom"></i> Vacuum Database
                        </button>
                        <div id="databaseStatusVaccum" class="options_alert hidden"></div>
                    </div>
                </div>

                <!-- Download Backup Card -->
                <div class="stat_card">
                    <div class="stat-icon">
                        <i class="fas fa-download"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Download Backup</div>
                        <p class="stat-description">Download the latest backup of the database.</p>
                        <button type="button" id="backupDbBtn" class="database_action_btn">
                            <i class="fas fa-cloud-download-alt"></i> Download Backup
                        </button>
                    </div>
                </div>
            </div>

            <div class="tables_grid">
                <h3>Tables Information</h3>
                <div id="tablesInfo" class="grid_container">
                    <!-- Populated via JavaScript -->
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Log Tab -->
    {% if user_is_admin or user_options_tabs.get('log', False) %}
    <div class="options_tab_content hidden" id="Log_tab">
        <div class="options_log_card">
            <div class="options_log_header">
                <div>
                    <h2>System Logs</h2>
                    <p class="options_log_subtitle">View and manage system logs</p>
                </div>
                <span id="logCount" class="log-count">Found 0 log files</span>
            </div>


                <div class="stats_grid">
                    <div class="stat_card">
                        <div class="stat-icon">
                            <i class="fas fa-toggle-on"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Enable Logs</div>
                            <div class="control-container">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="systemLogEnabled" class="toggle-input">
                                    <label for="systemLogEnabled" class="toggle-label">
                                        <span class="toggle-inner"></span>
                                        <span class="toggle-switch-text-on">ON</span>
                                        <span class="toggle-switch-text-off">OFF</span>
                                    </label>
                                </div>
                            </div>
                            <p class="stat-description">System events and operations</p>
                        </div>
                    </div>
                    <div class="stat_card">
                        <div class="stat-icon">
                            <i class="fas fa-list"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Log Level</div>
                            <div class="control-container">
                                <select id="logLevelSelect" class="form-select">
                                    <option value="DEBUG">DEBUG</option>
                                    <option value="INFO">INFO</option>
                                    <option value="WARNING">WARNING</option>
                                    <option value="ERROR">ERROR</option>
                                    <option value="CRITICAL">CRITICAL</option>
                                </select>
                            </div>
                            <p class="stat-description">Select the log level</p>
                        </div>
                    </div>
                    <div class="stat_card">
                        <div class="stat-icon">
                            <i class="fas fa-tools"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Werkzeug Logs</div>
                            <div class="control-container">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="werkzeugLogEnabled" class="toggle-input">
                                    <label for="werkzeugLogEnabled" class="toggle-label">
                                        <span class="toggle-inner"></span>
                                        <span class="toggle-switch-text-on">ON</span>
                                        <span class="toggle-switch-text-off">OFF</span>
                                    </label>
                                </div>
                            </div>
                            <p class="stat-description">Enable/disable Werkzeug logs</p>
                        </div>
                    </div>
                    <div class="stat_card">
                        <div class="stat-icon">
                            <i class="fas fa-code"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">JavaScript Logs</div>
                            <div class="control-container">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="javascriptLogEnabled" class="toggle-input" checked>
                                    <label for="javascriptLogEnabled" class="toggle-label">
                                        <span class="toggle-inner"></span>
                                        <span class="toggle-switch-text-on">ON</span>
                                        <span class="toggle-switch-text-off">OFF</span>
                                    </label>
                                </div>
                            </div>
                            <p class="stat-description">Enable/disable JavaScript console logs</p>
                        </div>
                    </div>
                    <div class="stat_card">
                        <div class="stat-icon">
                            <i class="fas fa-save"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Save & Restart</div>
                            <div class="control-container">
                                <button type="button" id="saveAndRestartBtn" class="options_btn">
                                    <i class="fas fa-sync"></i>
                                    <span class="btn-text">Save & Restart</span>
                                </button>
                            </div>
                            <p class="stat-description">Apply changes and restart the system</p>
                        </div>
                    </div>
                </div>
                <div id="logStatus" class="options_alert hidden"></div>


            <!-- Log Filters -->
            <div class="options_log_filters">
                <div class="options_log_filter_group">
                    <label for="logType">Log Type</label>
                    <select id="logType">
                        <option value="all">All Logs</option>
                        <option value="system">System Logs</option>
                        <option value="database">Database Logs</option>
                        <option value="ups">UPS Logs</option>
                        <option value="energy">Energy Logs</option>
                        <option value="web">Web Logs</option>
                        <option value="mail">Mail Logs</option>
                        <option value="options">Options Logs</option>
                        <option value="battery">Battery Logs</option>
                        <option value="upsmon">UPS Monitor Logs</option>
                        <option value="socket">Socket Logs</option>
                        <option value="voltage">Voltage Logs</option>
                        <option value="power">Power Logs</option>
                    </select>
                </div>

                <div class="options_log_filter_group">
                    <label for="logLevel">Log Level</label>
                    <select id="logLevel">
                        <option value="all">All Levels</option>
                        <option value="debug">Debug</option>
                        <option value="info">Info</option>
                        <option value="warning">Warning</option>
                        <option value="error">Error</option>
                    </select>
                </div>

                <div class="options_log_filter_group">
                    <label for="dateRange">Date Range</label>
                    <select id="dateRange">
                        <option value="today">Today</option>
                        <option value="week">Last Week</option>
                        <option value="month">Last Month</option>
                        <option value="all">All Time</option>
                    </select>
                </div>
            </div>

            <!-- Actions -->
            <div class="options_log_actions">
                <button type="button" id="refreshLogsBtn">
                    <i class="fas fa-sync"></i>
                    Refresh
                </button>
                <button type="button" id="downloadLogsBtn">
                    <i class="fas fa-download"></i>
                    Download Logs
                </button>
                <button type="button" id="clearLogsBtn">
                    <i class="fas fa-trash"></i>
                    Clear Logs
                </button>
            </div>

            <!-- Log Preview -->
            <div class="options_log_preview">
                <pre id="logPreview">Select filters to preview logs...</pre>
            </div>


        </div>
    </div>
    {% endif %}

    <!-- Advanced NUT Configuration Tab -->
    {% if user_is_admin or user_options_tabs.get('advanced', False) %}
    <div class="options_tab_content" id="Advanced_tab">
        <div class="options_card collapse-card">
            <div class="card_header collapse-header">
                <div class="collapse-header-content">
                    <h2>Advanced NUT Configuration</h2>
                    <p class="card_subtitle">Configure Network UPS Tools (NUT) files directly</p>
                </div>
                <div class="collapse-toggle">
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
            
            <div id="advanced_alert_container" class="options_alert_container"></div>
            
            <div class="advanced_nut_config collapse-content collapsed">
                <div class="advanced_selection">
                    <label for="advanced_nut_file_select">Select Configuration File:</label>
                    <select id="advanced_nut_file_select" class="form-select">
                        <option value="">Select a file</option>
                        <!-- Files will be loaded dynamically -->
                    </select>
                </div>
                
                <div class="advanced_editor_layout">
                    <div id="advanced_editor_container" class="advanced_editor_section">
                        <h3>Configuration Editor</h3>
                        <textarea id="advanced_editor"></textarea>
                    </div>
                    
                    <div id="advanced_docs_container" class="advanced_docs_section">
                        <h3>Documentation</h3>
                        <p>Select a configuration file to view documentation.</p>
                    </div>
                </div>
                
                <div class="advanced_buttons">
                    <button id="advanced_save_btn" class="options_btn">
                        <i class="fas fa-save"></i> Save Configuration
                    </button>
                    <button id="advanced_restart_btn" class="options_btn">
                        <i class="fas fa-sync"></i> Save & Restart Services
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Polling Interval Configuration card -->
        <div class="options_card mt-4">
            <div class="card_header">
                <div>
                    <h2>Polling Interval Configuration</h2>
                    <p class="card_subtitle">Configure UPS data polling interval</p>
                </div>
            </div>
            
            <div>
                <div class="mt-4 mb-4">
                    <p>Set the interval at which the application polls data from your UPS. Lower values provide more frequent updates but increase system load.</p>
                    
                    <div class="options_form_row" style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap; margin-top: 20px;">
                        <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                            <div style="display: flex; align-items: center;">
                                <i class="fas fa-clock" style="margin-right: 8px;"></i>
                                <span>Polling Interval (seconds)</span>
                            </div>
                            <div style="width: 200px;">
                                <select id="polling_interval" name="polling_interval" class="options_input" style="width: 100%;">
                                    <option value="1">1 second</option>
                                    <option value="2">2 seconds</option>
                                    <option value="4">4 seconds</option>
                                    <option value="6">6 seconds</option>
                                    <option value="8">8 seconds</option>
                                    <option value="10">10 seconds</option>
                                    <option value="12">12 seconds</option>
                                    <option value="14">14 seconds</option>
                                    <option value="16">16 seconds</option>
                                    <option value="18">18 seconds</option>
                                    <option value="20">20 seconds</option>
                                    <option value="22">22 seconds</option>
                                    <option value="24">24 seconds</option>
                                    <option value="26">26 seconds</option>
                                    <option value="28">28 seconds</option>
                                    <option value="30">30 seconds</option>
                                    <option value="32">32 seconds</option>
                                    <option value="34">34 seconds</option>
                                    <option value="36">36 seconds</option>
                                    <option value="38">38 seconds</option>
                                    <option value="40">40 seconds</option>
                                    <option value="42">42 seconds</option>
                                    <option value="44">44 seconds</option>
                                    <option value="46">46 seconds</option>
                                    <option value="48">48 seconds</option>
                                    <option value="50">50 seconds</option>
                                    <option value="52">52 seconds</option>
                                    <option value="54">54 seconds</option>
                                    <option value="56">56 seconds</option>
                                    <option value="58">58 seconds</option>
                                    <option value="60">60 seconds</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button type="button" id="savePollingBtn" class="options_btn options_btn_primary">
                                <i class="fas fa-save"></i> Save &amp; Reboot
                            </button>
                            <button type="button" id="resetPollingBtn" class="options_btn options_btn_secondary">
                                <i class="fas fa-undo"></i> Reset
                            </button>
                        </div>
                    </div>
                    
                    <div id="polling_thread_status" class="options_alert hidden mt-4"></div>
                </div>
            </div>
        </div>
        
        <!-- Download Json upsc result card -->
        <div class="options_card mt-4">
            <div class="card_header">
                <div class="notification_header">
                    <h2>Download Json upsc result</h2>
                    <button type="button" id="downloadUpsJsonBtn" class="options_btn options_btn_primary">
                        <i class="fas fa-download"></i> Download UPS JSON
                    </button>
                </div>
                <p class="card_subtitle">Download the complete UPS data in JSON format</p>
            </div>
        </div>
        
        <!-- Initial Setup Variables card -->
        <div class="options_card mt-4">
            <div class="card_header">
                <div class="notification_header">
                    <h2>Initial Setup Variables</h2>
                    <button type="button" id="saveInitialSetupBtn" class="options_btn options_btn_primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
                <p class="card_subtitle">View and modify the initial setup configuration variables</p>
            </div>
            <div class="p-4">
                <div id="initialSetupAlertContainer"></div>
                <form id="initialSetupForm">
                    <!-- All form fields in a single row -->
                    <div class="options_mail_form_grid">
                        <div class="options_mail_form_group">
                            <label for="server_name"><i class="fas fa-server"></i> Server Name:</label>
                            <input type="text" id="server_name" class="options_input" placeholder="Server name">
                            <p class="card_subtitle">The Server Name is used to identify the server in notifications.</p>

                        </div>
                        
                        <div class="options_mail_form_group">
                            <label for="timezone"><i class="fas fa-globe"></i> Timezone:</label>
                            <select id="timezone" class="options_input form-select dropdown-below">
                                <option value="">Select timezone</option>
                                <!-- Common timezones first -->
                                <option value="Europe/Rome">Europe/Rome</option>
                                <option value="Europe/London">Europe/London</option>
                                <option value="America/New_York">America/New_York</option>
                                <option value="America/Los_Angeles">America/Los_Angeles</option>
                                <option value="Asia/Tokyo">Asia/Tokyo</option>
                                <option value="Australia/Sydney">Australia/Sydney</option>
                                <option value="UTC">UTC</option>
                                
                                <!-- Africa -->
                                <optgroup label="Africa">
                                    {% for tz in timezones %}
                                        {% if tz.startswith('Africa/') %}
                                            <option value="{{ tz }}">{{ tz }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </optgroup>
                                
                                <!-- America -->
                                <optgroup label="America">
                                    {% for tz in timezones %}
                                        {% if tz.startswith('America/') %}
                                            <option value="{{ tz }}">{{ tz }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </optgroup>
                                
                                <!-- Antarctica -->
                                <optgroup label="Antarctica">
                                    {% for tz in timezones %}
                                        {% if tz.startswith('Antarctica/') %}
                                            <option value="{{ tz }}">{{ tz }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </optgroup>
                                
                                <!-- Asia -->
                                <optgroup label="Asia">
                                    {% for tz in timezones %}
                                        {% if tz.startswith('Asia/') %}
                                            <option value="{{ tz }}">{{ tz }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </optgroup>
                                
                                <!-- Atlantic -->
                                <optgroup label="Atlantic">
                                    {% for tz in timezones %}
                                        {% if tz.startswith('Atlantic/') %}
                                            <option value="{{ tz }}">{{ tz }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </optgroup>
                                
                                <!-- Australia -->
                                <optgroup label="Australia">
                                    {% for tz in timezones %}
                                        {% if tz.startswith('Australia/') %}
                                            <option value="{{ tz }}">{{ tz }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </optgroup>
                                
                                <!-- Europe -->
                                <optgroup label="Europe">
                                    {% for tz in timezones %}
                                        {% if tz.startswith('Europe/') %}
                                            <option value="{{ tz }}">{{ tz }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </optgroup>
                                
                                <!-- Indian -->
                                <optgroup label="Indian">
                                    {% for tz in timezones %}
                                        {% if tz.startswith('Indian/') %}
                                            <option value="{{ tz }}">{{ tz }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </optgroup>
                                
                                <!-- Pacific -->
                                <optgroup label="Pacific">
                                    {% for tz in timezones %}
                                        {% if tz.startswith('Pacific/') %}
                                            <option value="{{ tz }}">{{ tz }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </optgroup>
                                
                                <!-- UTC -->
                                <optgroup label="UTC">
                                    {% for tz in timezones %}
                                        {% if tz.startswith('UTC') %}
                                            <option value="{{ tz }}">{{ tz }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </optgroup>
                            </select>
                            <p class="card_subtitle">Use this setting to adjust the timezone for the frontend display, as well as for notifications and reports. Data in the database remains stored in UTC to guarantee accuracy and reliability.</p>
                        </div>
                        <div class="options_mail_form_group">
                            <label for="ups_realpower_nominal"><i class="fas fa-bolt"></i> UPS Nominal Power (W):</label>
                            <input type="number" id="ups_realpower_nominal" class="options_input" placeholder="e.g. 1500">
                            <p class="card_subtitle">Only include this if your UPS does not have the ups.realpower.nominal variable. To be sure, download the JSON above and check.</p>
                        </div>
                    </div>
                </form>
            </div>
            

        </div>
    </div>
    {% endif %}

    <!-- Admin Tab -->
    {% if user_is_admin or user_options_tabs.get('admin', False) %}
    <div class="options_tab_content hidden" id="Admin_tab">
        <!-- User Management Section (Admin Only) -->
        <div id="adminUserManagement" class="options_card" style="display: none;">
            <div class="card_header">
                <div class="notification_header">
                    <h2><i class="fas fa-users-cog"></i> User Management</h2>
                </div>
                <p class="card_subtitle">Manage system users and their permissions</p>
            </div>
            <div id="usersTableContainer">
                <!-- Users table will be populated dynamically -->
            </div>
        </div>

        <!-- Regular User Section -->
        <div id="regularUserSection">
            <!-- Current User Info -->
            <div class="options_card">
                <div class="card_header">
                    <div class="notification_header">
                        <h2><i class="fas fa-user-circle"></i> Current User</h2>
                    </div>
                    <p class="card_subtitle">Your account information</p>
                </div>
                <div id="options_admin_status" class="options_alert hidden"></div>
                <div class="options_nutify_grid">
                    <div class="options_notification_card">
                        <div class="options_nutify_header">
                            <div class="options_nutify_icon">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="options_nutify_title_container">
                                <span class="options_nutify_title">Username</span>
                                <span class="options_nutify_description" id="currentUsername">Loading...</span>
                            </div>
                        </div>
                    </div>
                    <div class="options_notification_card">
                        <div class="options_nutify_header">
                            <div class="options_nutify_icon">
                                <i class="fas fa-id-card"></i>
                            </div>
                            <div class="options_nutify_title_container">
                                <span class="options_nutify_title">User ID</span>
                                <span class="options_nutify_description" id="currentUserId">Loading...</span>
                            </div>
                        </div>
                    </div>
                    <div class="options_notification_card">
                        <div class="options_nutify_header">
                            <div class="options_nutify_icon">
                                <i class="fas fa-user-tag"></i>
                            </div>
                            <div class="options_nutify_title_container">
                                <span class="options_nutify_title">User Role</span>
                                <span class="options_nutify_description" id="currentUserRole">Loading...</span>
                            </div>
                        </div>
                    </div>
                    <div class="options_notification_card">
                        <div class="options_nutify_header">
                            <div class="options_nutify_icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="options_nutify_title_container">
                                <span class="options_nutify_title">Last Login</span>
                                <span class="options_nutify_description" id="currentUserLastLogin">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="currentUserInfo" class="options_nutify_body"></div>
            </div>

                    <!-- Personal Account Management (for current user) -->
            <div class="options_card">
                <div class="card_header">
                    <div class="notification_header">
                        <h2><i class="fas fa-user-cog"></i> Personal Account</h2>
                    </div>
                    <p class="card_subtitle">Manage your personal account settings</p>
                </div>
                
                <!-- Change Password Section -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-key"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">Change Password</span>
                            <span class="options_nutify_description">Update your account password</span>
                        </div>
                        <button type="button" class="options_btn" onclick="adminTab.showChangePersonalPasswordModal()">
                            <i class="fas fa-key"></i> Change Password
                        </button>
                    </div>
                </div>

                <!-- Change Username Section -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-user-edit"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">Change Username</span>
                            <span class="options_nutify_description">Update your account username</span>
                        </div>
                        <button type="button" class="options_btn" onclick="adminTab.showChangePersonalUsernameModal()">
                            <i class="fas fa-user-edit"></i> Change Username
                        </button>
                    </div>
                </div>
            </div>


        </div> <!-- End regularUserSection -->
        
        <!-- User Page Permissions Modal -->
        <div id="userPermissionsModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-lock"></i> User Page Permissions</h3>
                </div>
                <div class="modal-body">
                    <div style="margin-bottom: 1rem;">
                        <strong>User: <span id="permissionUserName"></span></strong>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <p class="card_subtitle">Select which pages this user can access:</p>
                    </div>
                    <div class="permissions-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem;">
                        <div class="permission-item">
                            <label class="permission-label">
                                <input type="checkbox" id="perm_home" data-page="home" class="permission-checkbox">
                                <i class="fas fa-home"></i>
                                <span>Home Dashboard</span>
                            </label>
                        </div>
                        <div class="permission-item">
                            <label class="permission-label">
                                <input type="checkbox" id="perm_energy" data-page="energy" class="permission-checkbox">
                                <i class="fas fa-bolt"></i>
                                <span>Energy</span>
                            </label>
                        </div>
                        <div class="permission-item">
                            <label class="permission-label">
                                <input type="checkbox" id="perm_power" data-page="power" class="permission-checkbox">
                                <i class="fas fa-plug"></i>
                                <span>Power</span>
                            </label>
                        </div>
                        <div class="permission-item">
                            <label class="permission-label">
                                <input type="checkbox" id="perm_battery" data-page="battery" class="permission-checkbox">
                                <i class="fas fa-battery-half"></i>
                                <span>Battery</span>
                            </label>
                        </div>
                        <div class="permission-item">
                            <label class="permission-label">
                                <input type="checkbox" id="perm_voltage" data-page="voltage" class="permission-checkbox">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>Voltage</span>
                            </label>
                        </div>
                        <div class="permission-item">
                            <label class="permission-label">
                                <input type="checkbox" id="perm_info" data-page="info" class="permission-checkbox">
                                <i class="fas fa-info-circle"></i>
                                <span>Info</span>
                            </label>
                        </div>
                        <div class="permission-item">
                            <label class="permission-label">
                                <input type="checkbox" id="perm_command" data-page="command" class="permission-checkbox">
                                <i class="fas fa-terminal"></i>
                                <span>Command</span>
                            </label>
                        </div>
                        <div class="permission-item">
                            <label class="permission-label">
                                <input type="checkbox" id="perm_events" data-page="events" class="permission-checkbox">
                                <i class="fas fa-bell"></i>
                                <span>Events</span>
                            </label>
                        </div>
                        <div class="permission-item">
                            <label class="permission-label">
                                <input type="checkbox" id="perm_settings" data-page="settings" class="permission-checkbox">
                                <i class="fas fa-cog"></i>
                                <span>Settings</span>
                            </label>
                        </div>
                        <div class="permission-item">
                            <label class="permission-label">
                                <input type="checkbox" id="perm_options" data-page="options" class="permission-checkbox" disabled>
                                <i class="fas fa-sliders-h"></i>
                                <span>Options</span>
                                <button type="button" class="configure-settings-btn" onclick="adminTab.showOptionsTabsModal()" title="Configure Options Tabs Access">
                                    <i class="fas fa-cogs"></i>
                                </button>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="options_btn_secondary" onclick="adminTab.closeModal()">
                        Cancel
                    </button>
                    <button type="button" class="options_btn" onclick="adminTab.saveUserPermissions()">
                        <i class="fas fa-save"></i> Save Permissions
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Options Tabs Configuration Modal -->
    <div id="optionsTabsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cogs"></i> Configure Options Tabs Access</h3>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 1rem;">
                    <strong>User: <span id="optionsTabsUserName"></span></strong>
                </div>
                <div style="margin-bottom: 1rem;">
                    <p class="card_subtitle">Select which Options tabs this user can access:</p>
                </div>
                <div class="options-tabs-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;">
                    <div class="options-tab-item">
                        <label class="options-tab-label">
                            <input type="checkbox" id="tab_email" data-tab="email" class="options-tab-checkbox">
                            <i class="fas fa-envelope"></i>
                            <span>Email Configuration</span>
                        </label>
                    </div>
                    <div class="options-tab-item">
                        <label class="options-tab-label">
                            <input type="checkbox" id="tab_extranotifs" data-tab="extranotifs" class="options-tab-checkbox">
                            <i class="fas fa-sliders-h"></i>
                            <span>Extranotifs</span>
                        </label>
                    </div>
                    <div class="options-tab-item">
                        <label class="options-tab-label">
                            <input type="checkbox" id="tab_webhook" data-tab="webhook" class="options-tab-checkbox">
                            <i class="fas fa-globe"></i>
                            <span>Webhook</span>
                        </label>
                    </div>
                    <div class="options-tab-item">
                        <label class="options-tab-label">
                            <input type="checkbox" id="tab_powerflow" data-tab="powerflow" class="options-tab-checkbox">
                            <i class="fas fa-sliders-h"></i>
                            <span>PowerFlow</span>
                        </label>
                    </div>
                    <div class="options-tab-item">
                        <label class="options-tab-label">
                            <input type="checkbox" id="tab_database" data-tab="database" class="options-tab-checkbox">
                            <i class="fas fa-database"></i>
                            <span>Database</span>
                        </label>
                    </div>
                    <div class="options-tab-item">
                        <label class="options-tab-label">
                            <input type="checkbox" id="tab_log" data-tab="log" class="options-tab-checkbox">
                            <i class="fas fa-box"></i>
                            <span>Log</span>
                        </label>
                    </div>
                    <div class="options-tab-item">
                        <label class="options-tab-label">
                            <input type="checkbox" id="tab_advanced" data-tab="advanced" class="options-tab-checkbox">
                            <i class="fas fa-cogs"></i>
                            <span>Advanced</span>
                        </label>
                    </div>
                    <div class="options-tab-item">
                        <label class="options-tab-label">
                            <input type="checkbox" id="tab_admin" data-tab="admin" class="options-tab-checkbox">
                            <i class="fas fa-user-shield"></i>
                            <span>Admin</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="options_btn_secondary" onclick="adminTab.closeOptionsTabsModal()">
                    Cancel
                </button>
                <button type="button" class="options_btn" onclick="adminTab.saveOptionsTabsConfiguration()">
                    <i class="fas fa-save"></i> Save Configuration
                </button>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- About Tab -->
    <div class="options_tab_content hidden" id="About_tab">
        <div class="page_header">
            <div class="page_title">
                <p class="page_subtitle">Nutify Advanced UPS monitoring and energy management solution</p>
            </div>
            <div class="page_actions">
                <a href="https://github.com/DartSteven/nutify" target="_blank" class="contact-link">
                    <i class="fab fa-github"></i>
                    <span>Star on GitHub</span>
                </a>
            </div>
        </div>

        <!-- Project Info Cards -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;" class="mt-6">
            <!-- Status Info Card -->
            <div class="combined_card">
                <div class="card_header">
                    <h2>Project Status</h2>
                </div>
                <div style="padding: 0.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>Current Release</span>
                        <span id="projectVersion">{{ VERSION }}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>Last Update</span>
                        <span id="lastUpdate">{{ LAST_UPDATE }}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>Status</span>
                        <span id="projectStatus">{{ STATUS }}</span>
                    </div>
                </div>
            </div>

            <!-- Changelog Card -->
            <div class="combined_card">
                <div class="card_header">
                    <h2>Changelog</h2>
                </div>
                <div class="changelog-content" style="height: 71px; overflow-y: auto; padding: 0.5rem;">
                    <pre id="changelogText" class="changelog-text" style="margin: 0; font-size: 0.9rem;">{{ CHANGELOG }}</pre>
                </div>
            </div>
        </div>

        <!-- Author -->
        <div class="combined_card mt-6" style="min-height: 280px; height: auto;">
            <div class="combined_header">
                <h2>Author</h2>
            </div>
            
            <div style="display: flex; gap: 2rem; padding: 1rem 0;">
                <!-- Left side - Big Icon -->
                <div style="display: flex; justify-content: center; align-items: flex-start; flex: 0 0 200px; padding-top: 1rem;">
                    <div id="authorIcon" class="author-icon">
                        <div class="icon-container">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="image-container">
                            <!-- Proviamo diversi formati -->
                            <img id="authorImage" src="" alt="Author" style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                    </div>
                </div>

                <style>
                    .author-icon {
                        width: 180px;
                        height: 180px;
                        background: var(--bg-secondary);
                        border-radius: 50%;
                        position: relative;
                        box-shadow: 0 0 20px rgba(37, 99, 235, 0.1);
                        cursor: pointer;
                        overflow: hidden;
                    }

                    .icon-container {
                        position: absolute;
                        inset: 0;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        z-index: 2;
                        transition: opacity 0.5s ease;
                    }

                    .icon-container i {
                        font-size: 7rem;
                        color: var(--primary-color);
                    }

                    .image-container {
                        position: absolute;
                        inset: 0;
                        opacity: 0;
                        transition: opacity 0.5s ease;
                        z-index: 1;
                    }

                    .image-container img {
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                    }

                    .author-icon.show-image .icon-container {
                        opacity: 0;
                        z-index: 1;
                    }

                    .author-icon.show-image .image-container {
                        opacity: 1;
                        z-index: 2;
                    }
                </style>

                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        const authorIcon = document.getElementById('authorIcon');
                        const authorImage = document.getElementById('authorImage');
                        let hoverTimer;

                        fetch('/api/about/image')
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    authorImage.src = data.data;
                                }
                            });

                        authorImage.addEventListener('error', function() {
                            authorImage.src = '';
                        });

                        authorIcon.addEventListener('mouseenter', () => {
                            hoverTimer = setTimeout(() => {
                                authorIcon.classList.add('show-image');
                            }, 5000);
                        });

                        authorIcon.addEventListener('mouseleave', () => {
                            clearTimeout(hoverTimer);
                            authorIcon.classList.remove('show-image');
                        });
                    });
                </script>

                <!-- Right side - Content -->
                <div style="flex: 1; display: flex; flex-direction: column; justify-content: space-between; min-width: 0;">
                    <!-- Bio Text -->
                    <div style="flex: 1;">
                        <p style="line-height: 1.6; margin-bottom: 1rem;">
                            Hi, I'm <strong>Dart Steven</strong>, a technology enthusiast and self-taught developer with a passion for open-source solutions. I created Nutify to address the need for efficient UPS monitoring while exploring modern technologies. The project's name combines NUT (Network UPS Tools) with notifications, reflecting its core purpose: providing real-time device status updates through a modern interface.
                        </p>
                        <p style="line-height: 1.6; margin-bottom: 1.5rem;">
                            My journey in software development has been driven by curiosity and hands-on learning. Through experimenting with Python, JavaScript, and web technologies, I've focused on creating solutions that are both powerful and user-friendly. Nutify represents this philosophy, combining robust monitoring capabilities with an intuitive interface.
                        </p>
                    </div>

                    <!-- Contact Links -->
                    <div class="contact-grid" style="display: flex; gap: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                        <a href="https://github.com/DartSteven" target="_blank" class="contact-link" style="flex: 1; justify-content: center;">
                            <i class="fab fa-github"></i>
                            <span>GitHub</span>
                        </a>
                        <a href="mailto:dartsteven@icloud.com" class="contact-link" style="flex: 1; justify-content: center;">
                            <i class="fas fa-envelope"></i>
                            <span>Email</span>
                        </a>
                        <a href="https://buymeacoffee.com/dartsteven" target="_blank" class="contact-link" style="flex: 1; justify-content: center;">
                            <i class="fas fa-coffee"></i>
                            <span>Buy me a coffee</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- License -->
        <div class="combined_card mt-6" style="min-height: auto;">
            <div class="combined_header" style="cursor: pointer;" id="licenseTrigger">
                <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                    <h2>License</h2>
                    <i class="fas fa-chevron-down license-chevron" style="transition: transform 0.3s ease;"></i>
                </div>
            </div>
            
            <div id="licenseContent" class="license-content" style="display: none; transition: all 0.3s ease;">
                <div style="display: flex; gap: 2rem; padding: 1rem 0;">
                    <!-- Left side - License Icon -->
                    <div style="display: flex; justify-content: center; align-items: flex-start; flex: 0 0 200px; padding-top: 1rem;">
                        <div style="width: 180px; height: 180px; background: var(--bg-secondary); border-radius: 50%; display: flex; justify-content: center; align-items: center; position: relative; box-shadow: 0 0 20px rgba(37, 99, 235, 0.1);">
                            <div style="position: absolute; width: 100%; height: 100%; border-radius: 50%; border: 3px solid var(--primary-color); opacity: 0.2;"></div>
                            <div style="position: absolute; width: calc(100% - 10px); height: calc(100% - 10px); border-radius: 50%; border: 2px solid var(--primary-color); opacity: 0.3;"></div>
                            <i class="fas fa-balance-scale" style="font-size: 7rem; color: var(--primary-color); filter: drop-shadow(0 4px 6px rgba(37, 99, 235, 0.2));"></i>
                        </div>
                    </div>

                    <!-- Right side - License Content -->
                    <div style="flex: 1; display: flex; flex-direction: column; gap: 1.5rem;">
                        <!-- License Title and Description -->
                        <div>
                            <h3 style="font-size: 1.1rem; color: var(--text-primary); margin-bottom: 0.75rem;">Usage License – Customized Version Based on MIT</h3>
                            <p style="line-height: 1.6; color: var(--text-secondary);">
                                This software is released under a modified license for personal and non-commercial use. The license is designed to protect both users' freedom to use the software and the author's rights.
                            </p>
                        </div>

                        <!-- Terms of Use -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <!-- Permitted Uses Card -->
                            <div style="background: var(--bg-secondary); padding: 1.25rem; border-radius: 0.5rem;">
                                <h4 style="font-size: 0.9rem; color: var(--text-primary); margin-bottom: 1rem;">Permitted Uses</h4>
                                <ul style="list-style-type: none; padding: 0; display: flex; flex-direction: column; gap: 0.75rem;">
                                    <li style="display: flex; gap: 0.75rem; align-items: flex-start;">
                                        <i class="fas fa-check" style="color: var(--primary-color); width: 20px; margin-top: 3px;"></i>
                                        <span>The use, copying, and modification of the software are permitted solely for personal and non-commercial purposes.</span>
                                    </li>
                                    <li style="display: flex; gap: 0.75rem; align-items: flex-start;">
                                        <i class="fas fa-check" style="color: var(--primary-color); width: 20px; margin-top: 3px;"></i>
                                        <span>Any authorized use must include attribution to the original author.</span>
                                    </li>
                                </ul>
                            </div>

                            <!-- Restrictions Card -->
                            <div style="background: var(--bg-secondary); padding: 1.25rem; border-radius: 0.5rem;">
                                <h4 style="font-size: 0.9rem; color: var(--text-primary); margin-bottom: 1rem;">Restrictions</h4>
                                <ul style="list-style-type: none; padding: 0; display: flex; flex-direction: column; gap: 0.75rem;">
                                    <li style="display: flex; gap: 0.75rem; align-items: flex-start;">
                                        <i class="fas fa-times" style="color: #ef4444; width: 20px; margin-top: 3px;"></i>
                                        <span>Any commercial use requires written permission from the author.</span>
                                    </li>
                                    <li style="display: flex; gap: 0.75rem; align-items: flex-start;">
                                        <i class="fas fa-times" style="color: #ef4444; width: 20px; margin-top: 3px;"></i>
                                        <span>Unauthorized redistribution of both the original software and modified versions is not allowed.</span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- Warranty Disclaimer -->
                        <div style="background: var(--bg-secondary); padding: 1.25rem; border-radius: 0.5rem;">
                            <h4 style="font-size: 0.9rem; color: var(--text-primary); margin-bottom: 1rem;">Important Notice</h4>
                            <p style="line-height: 1.6; color: var(--text-secondary); margin-bottom: 0.75rem;">
                                The software is provided "as is," without any warranties of any kind, either express or implied. This includes but is not limited to warranties of merchantability, fitness for a particular purpose, and non-infringement.
                            </p>
                        </div>

                        <!-- Contact Section -->
                        <div style="display: flex; align-items: center; gap: 1rem; padding-top: 0.5rem; border-top: 1px solid var(--border-color);">
                            <div style="flex: 1; color: var(--text-secondary);">
                                <i class="fas fa-info-circle"></i>
                                For requests regarding usage, modifications, or distribution:
                            </div>
                            <a href="mailto:dartsteven@icloud.com" class="contact-link">
                                <i class="fas fa-envelope"></i>
                                <span>Contact Author</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Extranotifs Tab -->
    {% if user_is_admin or user_options_tabs.get('extranotifs', False) %}
    <div class="options_tab_content hidden" id="Extranotifs_tab">
        <!-- Ntfy Configuration Header Card -->
        <div class="options_card" id="addNtfyConfigContainer">
            <div class="card_header">
                <div class="notification_header">
                    <h2>Ntfy Configuration</h2>
                    <button type="button" id="addNtfyConfigBtn" class="options_btn">
                        <i class="fas fa-plus"></i> Add Ntfy Configuration
                    </button>
                </div>
                <p class="card_subtitle">Configure Ntfy for push notifications to your devices</p>
            </div>
        </div>
        
        <!-- Ntfy Configuration Form Card -->
        <div class="options_card" id="ntfyConfigFormCard" style="display: none;">
            <div class="ntfy-form-header">
                <h2>Ntfy Configuration</h2>
                <select id="ntfy_server_type" name="ntfy_server_type">
                    <option value="ntfy.sh">ntfy.sh (Official)</option>
                    <option value="custom">Self-hosted</option>
                </select>
            </div>
            
            <p class="ntfy-form-description">Configure Ntfy for push notifications to your devices</p>
            
            <form id="ntfyConfigForm">
                <!-- Hidden field for configuration ID -->
                <input type="hidden" id="ntfy_config_id" name="ntfy_config_id">
                
                <!-- Prima riga: Server URL, Topic, Default Priority -->
                <div class="ntfy-form-row">
                    <!-- Server URL (conditionally displayed) -->
                    <div id="custom_server_container" class="ntfy-form-field" style="display: none;">
                        <div class="ntfy-form-field-inner">
                            <i class="fas fa-globe"></i>
                            <label for="ntfy_custom_server">Server URL</label>
                            <input type="text" id="ntfy_custom_server" name="ntfy_custom_server" placeholder="https://your-ntfy-server.com">
                        </div>
                    </div>
                    
                    <!-- Topic field -->
                    <div class="ntfy-form-field">
                        <div class="ntfy-form-field-inner">
                            <i class="fas fa-tag"></i>
                            <label for="ntfy_topic">Topic</label>
                            <input type="text" id="ntfy_topic" name="ntfy_topic" placeholder="my-ups-notifications" required>
                        </div>
                    </div>
                    
                    <!-- Priority dropdown -->
                    <div class="ntfy-form-field">
                        <div class="ntfy-form-field-inner">
                            <i class="fas fa-exclamation-circle"></i>
                            <label for="ntfy_priority">Priority</label>
                            <select id="ntfy_priority" name="ntfy_priority">
                                <option value="1">1 (Min)</option>
                                <option value="2">2 (Low)</option>
                                <option value="3" selected>3 (Default)</option>
                                <option value="4">4 (High)</option>
                                <option value="5">5 (Max)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <hr class="ntfy-form-divider">
                
                <!-- Seconda riga: Authentication, Username, Password, Use Event Tags -->
                <div class="ntfy-form-row">
                    <!-- Authentication checkbox -->
                    <div class="ntfy-form-field checkbox-field">
                        <div class="ntfy-form-field-inner checkbox">
                            <i class="fas fa-lock"></i>
                            <label>
                                <input type="checkbox" id="ntfy_use_auth" name="ntfy_use_auth">
                                <span>Use Auth</span>
                                </label>
                            </div>
                        </div>
                    
                    <!-- Username field -->
                    <div class="ntfy-form-field auth-field">
                        <div class="ntfy-form-field-inner">
                            <i class="fas fa-user"></i>
                            <label for="ntfy_username">Username</label>
                            <input type="text" id="ntfy_username" name="ntfy_username">
                    </div>
                    </div>
                    
                    <!-- Password field -->
                    <div class="ntfy-form-field auth-field">
                        <div class="ntfy-form-field-inner">
                            <i class="fas fa-key"></i>
                            <label for="ntfy_password">Password</label>
                            <input type="password" id="ntfy_password" name="ntfy_password" placeholder="*************" autocomplete="new-password">
                        </div>
                    </div>
                    
                    <!-- Use Event Tags checkbox -->
                    <div class="ntfy-form-field checkbox-field">
                        <div class="ntfy-form-field-inner checkbox">
                            <i class="fas fa-tags"></i>
                            <label>
                                <input type="checkbox" id="ntfy_use_tags" name="ntfy_use_tags" checked>
                                <span>Use Event Tags</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <hr class="ntfy-form-divider">
                
                <!-- Info box -->
                <div class="ntfy-info-container">
                    <i class="fas fa-info-circle"></i>
                    <span>
                        Configure <a href="https://ntfy.sh" target="_blank">Ntfy</a> to receive instant push notifications on your devices. Download the Ntfy app from
                        <a href="https://play.google.com/store/apps/details?id=io.heckel.ntfy" target="_blank">Google Play</a>,
                        <a href="https://f-droid.org/en/packages/io.heckel.ntfy/" target="_blank">F-Droid</a>, or the
                        <a href="https://apps.apple.com/us/app/ntfy/id1625396347" target="_blank">App Store</a>.
                    </span>
                </div>
                
                <!-- Action buttons -->
                <div class="ntfy-actions">
                    <button type="button" id="testNtfyBtn" class="options_btn options_btn_secondary">
                        <i class="fas fa-paper-plane"></i>
                        <span class="btn-text">Test Notification</span>
                        <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                    </button>
                    <button type="button" id="saveNtfyConfigBtn" class="options_btn" style="display: none;">
                            <i class="fas fa-save"></i>
                        Save Configuration
                    </button>
                    <button type="button" id="cancelNtfyConfigBtn" class="options_btn options_btn_secondary">
                        <i class="fas fa-times"></i>
                        Cancel
                    </button>
                        </div>
                
                <div id="ntfyConfigurationStatus" class="options_mail_config_status hidden">
                    <p>Ntfy configured successfully</p>
                    <button type="button" id="reconfigureNtfyBtn">
                        <i class="fas fa-cog"></i>
                        Reconfigure
                    </button>
                </div>
                
                <div id="ntfyStatus" class="options_alert hidden"></div>
            </form>
        </div>
        
        <!-- Ntfy Configuration Summary Card -->
        <div class="options_card mt-4" id="ntfyConfigSummary">
            <div class="card_header">
                <div class="notification_header">
                    <h2>Configured Ntfy Services</h2>
                    <!-- Removing the "Add Another" button as requested -->
                </div>
                <p class="card_subtitle">Your Ntfy configurations</p>
            </div>
            
            <div class="email_config_summary" id="ntfyConfigList">
                <!-- Ntfy configurations will be listed here dynamically -->
            </div>
        </div>
        
        <!-- Ntfy Notifications section -->
        <div class="options_card mt-4">
            <div class="card_header">
                <div class="notification_header">
                    <h2>Ntfy Notifications</h2>
                </div>
                <p class="card_subtitle">Configure which events should trigger Ntfy notifications</p>
            </div>
            <div id="options_ntfy_status" class="options_alert hidden"></div>

            <div class="options_nutify_grid">
                <!-- ONLINE notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-plug"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">UPS on Line Power</span>
                            <span class="options_nutify_description">Notify when UPS returns to line power</span>
                        </div>
                        <button type="button" class="options_btn options_ntfy_test" data-event-type="ONLINE">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="ntfy_online" class="options_ntfy_checkbox toggle-input" data-event-type="ONLINE">
                                <label for="ntfy_online" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_ntfy_select" data-event-type="ONLINE">
                            <option value="">Select Ntfy config</option>
                            <!-- Ntfy options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <!-- ONBATT notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-battery-half"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">UPS on Battery</span>
                            <span class="options_nutify_description">Notify when UPS switches to battery power</span>
                        </div>
                        <button type="button" class="options_btn options_ntfy_test" data-event-type="ONBATT">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="ntfy_onbatt" class="options_ntfy_checkbox toggle-input" data-event-type="ONBATT">
                                <label for="ntfy_onbatt" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_ntfy_select" data-event-type="ONBATT">
                            <option value="">Select Ntfy config</option>
                            <!-- Ntfy options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <!-- LOWBATT notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-battery-empty"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">Low Battery</span>
                            <span class="options_nutify_description">Notify when battery is running low</span>
                        </div>
                        <button type="button" class="options_btn options_ntfy_test" data-event-type="LOWBATT">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="ntfy_lowbatt" class="options_ntfy_checkbox toggle-input" data-event-type="LOWBATT">
                                <label for="ntfy_lowbatt" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_ntfy_select" data-event-type="LOWBATT">
                            <option value="">Select Ntfy config</option>
                            <!-- Ntfy options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <!-- COMMOK notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-wifi"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">Communication Restored</span>
                            <span class="options_nutify_description">Notify when UPS communication is restored</span>
                        </div>
                        <button type="button" class="options_btn options_ntfy_test" data-event-type="COMMOK">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="ntfy_commok" class="options_ntfy_checkbox toggle-input" data-event-type="COMMOK">
                                <label for="ntfy_commok" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_ntfy_select" data-event-type="COMMOK">
                            <option value="">Select Ntfy config</option>
                            <!-- Ntfy options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <!-- COMMBAD notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">Communication Lost</span>
                            <span class="options_nutify_description">Notify when UPS communication is lost</span>
                        </div>
                        <button type="button" class="options_btn options_ntfy_test" data-event-type="COMMBAD">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="ntfy_commbad" class="options_ntfy_checkbox toggle-input" data-event-type="COMMBAD">
                                <label for="ntfy_commbad" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_ntfy_select" data-event-type="COMMBAD">
                            <option value="">Select Ntfy config</option>
                            <!-- Ntfy options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <!-- SHUTDOWN notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-power-off"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">Shutdown Imminent</span>
                            <span class="options_nutify_description">Notify when system shutdown is about to start</span>
                        </div>
                        <button type="button" class="options_btn options_ntfy_test" data-event-type="SHUTDOWN">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="ntfy_shutdown" class="options_ntfy_checkbox toggle-input" data-event-type="SHUTDOWN">
                                <label for="ntfy_shutdown" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_ntfy_select" data-event-type="SHUTDOWN">
                            <option value="">Select Ntfy config</option>
                            <!-- Ntfy options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <!-- REPLBATT notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-battery-full"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">Replace Battery</span>
                            <span class="options_nutify_description">Notify when battery needs replacement</span>
                        </div>
                        <button type="button" class="options_btn options_ntfy_test" data-event-type="REPLBATT">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="ntfy_replbatt" class="options_ntfy_checkbox toggle-input" data-event-type="REPLBATT">
                                <label for="ntfy_replbatt" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_ntfy_select" data-event-type="REPLBATT">
                            <option value="">Select Ntfy config</option>
                            <!-- Ntfy options will be populated dynamically -->
                        </select>
                    </div>
                </div>

                <!-- NOCOMM notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-wifi-slash"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">No Communication</span>
                            <span class="options_nutify_description">Notify when UPS is not reachable</span>
                        </div>
                        <button type="button" class="options_btn options_ntfy_test" data-event-type="NOCOMM">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="ntfy_nocomm" class="options_ntfy_checkbox toggle-input" data-event-type="NOCOMM">
                                <label for="ntfy_nocomm" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_ntfy_select" data-event-type="NOCOMM">
                            <option value="">Select Ntfy config</option>
                            <!-- Ntfy options will be populated dynamically -->
                        </select>
                    </div>
                </div>

                <!-- NOPARENT notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-child"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">Parent Process Lost</span>
                            <span class="options_nutify_description">Notify when parent process is lost</span>
                        </div>
                        <button type="button" class="options_btn options_ntfy_test" data-event-type="NOPARENT">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="ntfy_noparent" class="options_ntfy_checkbox toggle-input" data-event-type="NOPARENT">
                                <label for="ntfy_noparent" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_ntfy_select" data-event-type="NOPARENT">
                            <option value="">Select Ntfy config</option>
                            <!-- Ntfy options will be populated dynamically -->
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Webhook Tab -->
    {% if user_is_admin or user_options_tabs.get('webhook', False) %}
    <div class="options_tab_content hidden" id="Webhook_tab">
        <!-- Webhook Configuration Header Card -->
        <div class="options_card" id="addWebhookConfigContainer">
            <div class="card_header">
                <div class="notification_header">
                    <h2>Webhook Configuration</h2>
                    <button type="button" id="addWebhookConfigBtn" class="options_btn">
                        <i class="fas fa-plus"></i> Add Webhook Configuration
                    </button>
                </div>
                <p class="card_subtitle">Configure webhook endpoints for system notifications</p>
            </div>
        </div>
        
        <!-- Webhook Configuration Form Card -->
        <div class="options_card" id="webhookConfigFormCard" style="display: none;">
            <div class="ntfy-form-header">
                <h2>Webhook Configuration</h2>
                <select id="webhook_server_type" name="webhook_server_type">
                    <option value="custom">Custom</option>
                    <option value="discord">Discord</option>
                </select>
            </div>
            <p class="ntfy-form-description">Configure webhook endpoints for system notifications</p>
            
            <form id="webhookConfigForm">
                <!-- Hidden field for configuration ID -->
                <input type="hidden" id="webhook_config_id" name="webhook_config_id">
                
                <!-- First row: Name and URL -->
                <div class="ntfy-form-row">
                    <!-- Name field -->
                    <div class="ntfy-form-field">
                        <div class="ntfy-form-field-inner">
                            <i class="fas fa-tag"></i>
                            <label for="webhook_name">Name</label>
                            <input type="text" id="webhook_name" name="webhook_name" placeholder="My Webhook" required>
                        </div>
                    </div>
                    
                    <!-- URL field -->
                    <div class="ntfy-form-field">
                        <div class="ntfy-form-field-inner">
                            <i class="fas fa-globe"></i>
                            <label for="webhook_url">URL</label>
                            <input type="text" id="webhook_url" name="webhook_url" placeholder="https://example.com/webhook" required>
                        </div>
                    </div>
                </div>
                
                <hr class="ntfy-form-divider">
                
                <!-- Second row: Content Type and Include UPS Data -->
                <div class="ntfy-form-row">
                    <!-- Content Type field -->
                    <div class="ntfy-form-field">
                        <div class="ntfy-form-field-inner">
                            <i class="fas fa-code"></i>
                            <label for="webhook_content_type">Content Type</label>
                            <select id="webhook_content_type" name="webhook_content_type">
                                <option value="application/json" selected>application/json</option>
                                <option value="application/xml">application/xml</option>
                                <option value="text/plain">text/plain</option>
                                <option value="application/x-www-form-urlencoded">application/x-www-form-urlencoded</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Include UPS Data checkbox -->
                    <div class="ntfy-form-field checkbox-field">
                        <div class="ntfy-form-field-inner checkbox">
                            <i class="fas fa-database"></i>
                            <label>
                                <input type="checkbox" id="webhook_include_ups_data" name="webhook_include_ups_data" checked>
                                <span>Include UPS Data</span>
                            </label>
                        </div>
                    </div>

                    <!-- SSL Verification checkbox -->
                    <div class="ntfy-form-field checkbox-field">
                        <div class="ntfy-form-field-inner checkbox">
                            <i class="fas fa-shield-alt"></i>
                            <label>
                                <input type="checkbox" id="webhook_verify_ssl" name="webhook_verify_ssl" checked>
                                <span>Verify SSL certificates</span>
                            </label>
                            <div class="ntfy-tooltip">
                                <i class="fas fa-info-circle"></i>
                                <span class="ntfy-tooltiptext">Disable for self-signed certificates or when SSL verification fails</span>
                            </div>
                        </div>
                    </div>
                </div>

                <hr class="ntfy-form-divider">
                
                <!-- Third row: Authentication -->
                <div class="ntfy-form-row">
                    <!-- Authentication Type -->
                    <div class="ntfy-form-field">
                        <div class="ntfy-form-field-inner">
                            <i class="fas fa-lock"></i>
                            <label for="webhook_auth_type">Authentication</label>
                            <select id="webhook_auth_type" name="webhook_auth_type">
                                <option value="none" selected>None</option>
                                <option value="basic">Basic Auth</option>
                                <option value="bearer">Bearer Token</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Auth fields (shown conditionally) -->
                <div id="webhook_basic_auth_fields" style="display: none;">
                    <div class="ntfy-form-row">
                        <div class="ntfy-form-field">
                            <div class="ntfy-form-field-inner">
                                <i class="fas fa-user"></i>
                                <label for="webhook_auth_username">Username</label>
                                <input type="text" id="webhook_auth_username" name="webhook_auth_username">
                            </div>
                        </div>
                        
                        <div class="ntfy-form-field">
                            <div class="ntfy-form-field-inner">
                                <i class="fas fa-key"></i>
                                <label for="webhook_auth_password">Password</label>
                                <input type="password" id="webhook_auth_password" name="webhook_auth_password" 
                                      autocomplete="new-password" placeholder="*************">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="webhook_bearer_auth_fields" style="display: none;">
                    <div class="ntfy-form-row">
                        <div class="ntfy-form-field">
                            <div class="ntfy-form-field-inner">
                                <i class="fas fa-key"></i>
                                <label for="webhook_auth_token">Token</label>
                                <input type="password" id="webhook_auth_token" name="webhook_auth_token" 
                                      autocomplete="new-password" placeholder="*************">
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr class="ntfy-form-divider">
                
                <!-- Custom Headers -->
                <div class="ntfy-form-row">
                    <div class="ntfy-form-field" style="flex-grow: 2;">
                        <div class="ntfy-form-field-inner">
                            <i class="fas fa-list"></i>
                            <label for="webhook_custom_headers" style="display: block; margin-bottom: 5px;">Custom Headers (JSON format)</label>
                            <textarea id="webhook_custom_headers" name="webhook_custom_headers" rows="6" style="min-height: 100px; width: 100%;" 
                                     placeholder='{"X-Api-Key": "your-api-key", "X-Custom-Header": "value"}'></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- Info box -->
                <div class="ntfy-info-container">
                    <i class="fas fa-info-circle"></i>
                    <span>
                        Configure webhooks to integrate with external systems. Webhooks will send HTTP requests with event data to your specified URL.
                    </span>
                </div>
                
                <!-- Action buttons -->
                <div class="ntfy-actions">
                    <button type="button" id="testWebhookBtn" class="options_btn options_btn_secondary">
                        <i class="fas fa-paper-plane"></i>
                        <span class="btn-text">Test Webhook</span>
                        <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                    </button>
                    <button type="button" id="saveWebhookConfigBtn" class="options_btn" style="display: none;">
                        <i class="fas fa-save"></i>
                        Save Configuration
                    </button>
                    <button type="button" id="cancelWebhookConfigBtn" class="options_btn options_btn_secondary">
                        <i class="fas fa-times"></i>
                        Cancel
                    </button>
                </div>
                
                <div id="webhookConfigurationStatus" class="options_mail_config_status hidden">
                    <p>Webhook configured successfully</p>
                    <button type="button" id="reconfigureWebhookBtn">
                        <i class="fas fa-cog"></i>
                        Reconfigure
                    </button>
                </div>
                
                <div id="webhookStatus" class="options_alert hidden"></div>
            </form>
        </div>
        
        <!-- Webhook Configuration Summary Card -->
        <div class="options_card mt-4" id="webhookConfigSummary">
            <div class="card_header">
                <div class="notification_header">
                    <h2>Configured Webhooks</h2>
                </div>
                <p class="card_subtitle">Your webhook notification services</p>
            </div>
            
            <div class="email_config_summary" id="webhookConfigList">
                <!-- Webhook configurations will be listed here dynamically -->
            </div>
        </div>
        
        <!-- Webhook Notifications section -->
        <div class="options_card mt-4">
            <div class="card_header">
                <div class="notification_header">
                    <h2>Webhook Notifications</h2>
                </div>
                <p class="card_subtitle">Configure which events should trigger webhook notifications</p>
            </div>
            <div id="options_webhook_status" class="options_alert hidden"></div>
            
            <div class="options_nutify_grid">
                <!-- ONLINE notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-plug"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">UPS on Line Power</span>
                            <span class="options_nutify_description">Notify when UPS returns to line power</span>
                        </div>
                        <button type="button" class="options_btn options_webhook_test" data-event-type="ONLINE">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="webhook_online" class="options_webhook_checkbox toggle-input" data-event-type="ONLINE">
                                <label for="webhook_online" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_webhook_select" data-event-type="ONLINE">
                            <option value="">Select webhook</option>
                            <!-- Webhook options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <!-- ONBATT notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-battery-half"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">UPS on Battery</span>
                            <span class="options_nutify_description">Notify when UPS switches to battery power</span>
                        </div>
                        <button type="button" class="options_btn options_webhook_test" data-event-type="ONBATT">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="webhook_onbatt" class="options_webhook_checkbox toggle-input" data-event-type="ONBATT">
                                <label for="webhook_onbatt" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_webhook_select" data-event-type="ONBATT">
                            <option value="">Select webhook</option>
                            <!-- Webhook options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <!-- LOWBATT notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-battery-empty"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">Low Battery</span>
                            <span class="options_nutify_description">Notify when battery is running low</span>
                        </div>
                        <button type="button" class="options_btn options_webhook_test" data-event-type="LOWBATT">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="webhook_lowbatt" class="options_webhook_checkbox toggle-input" data-event-type="LOWBATT">
                                <label for="webhook_lowbatt" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_webhook_select" data-event-type="LOWBATT">
                            <option value="">Select webhook</option>
                            <!-- Webhook options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <!-- COMMOK notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-wifi"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">Communication Restored</span>
                            <span class="options_nutify_description">Notify when UPS communication is restored</span>
                        </div>
                        <button type="button" class="options_btn options_webhook_test" data-event-type="COMMOK">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="webhook_commok" class="options_webhook_checkbox toggle-input" data-event-type="COMMOK">
                                <label for="webhook_commok" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_webhook_select" data-event-type="COMMOK">
                            <option value="">Select webhook</option>
                            <!-- Webhook options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <!-- COMMBAD notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">Communication Lost</span>
                            <span class="options_nutify_description">Notify when UPS communication is lost</span>
                        </div>
                        <button type="button" class="options_btn options_webhook_test" data-event-type="COMMBAD">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="webhook_commbad" class="options_webhook_checkbox toggle-input" data-event-type="COMMBAD">
                                <label for="webhook_commbad" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_webhook_select" data-event-type="COMMBAD">
                            <option value="">Select webhook</option>
                            <!-- Webhook options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <!-- SHUTDOWN notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-power-off"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">Shutdown Imminent</span>
                            <span class="options_nutify_description">Notify when system shutdown is about to start</span>
                        </div>
                        <button type="button" class="options_btn options_webhook_test" data-event-type="SHUTDOWN">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="webhook_shutdown" class="options_webhook_checkbox toggle-input" data-event-type="SHUTDOWN">
                                <label for="webhook_shutdown" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_webhook_select" data-event-type="SHUTDOWN">
                            <option value="">Select webhook</option>
                            <!-- Webhook options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <!-- REPLBATT notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-battery-full"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">Replace Battery</span>
                            <span class="options_nutify_description">Notify when battery needs replacement</span>
                        </div>
                        <button type="button" class="options_btn options_webhook_test" data-event-type="REPLBATT">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="webhook_replbatt" class="options_webhook_checkbox toggle-input" data-event-type="REPLBATT">
                                <label for="webhook_replbatt" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_webhook_select" data-event-type="REPLBATT">
                            <option value="">Select webhook</option>
                            <!-- Webhook options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <!-- NOCOMM notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-wifi-slash"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">No Communication</span>
                            <span class="options_nutify_description">Notify when UPS is not reachable</span>
                        </div>
                        <button type="button" class="options_btn options_webhook_test" data-event-type="NOCOMM">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="webhook_nocomm" class="options_webhook_checkbox toggle-input" data-event-type="NOCOMM">
                                <label for="webhook_nocomm" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_webhook_select" data-event-type="NOCOMM">
                            <option value="">Select webhook</option>
                            <!-- Webhook options will be populated dynamically -->
                        </select>
                    </div>
                </div>

                <!-- NOPARENT notification -->
                <div class="options_notification_card">
                    <div class="options_nutify_header">
                        <div class="options_nutify_icon">
                            <i class="fas fa-child"></i>
                        </div>
                        <div class="options_nutify_title_container">
                            <span class="options_nutify_title">Parent Process Lost</span>
                            <span class="options_nutify_description">Notify when parent process is lost</span>
                        </div>
                        <button type="button" class="options_btn options_webhook_test" data-event-type="NOPARENT">
                            <span class="btn-text">Test</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                        <div class="options_nutify_toggle">
                            <div class="toggle-switch">
                                <input type="checkbox" id="webhook_noparent" class="options_webhook_checkbox toggle-input" data-event-type="NOPARENT">
                                <label for="webhook_noparent" class="toggle-label">
                                    <span class="toggle-inner"></span>
                                    <span class="toggle-switch-text-on">ON</span>
                                    <span class="toggle-switch-text-off">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="options_nutify_body">
                        <select class="options_webhook_select" data-event-type="NOPARENT">
                            <option value="">Select webhook</option>
                            <!-- Webhook options will be populated dynamically -->
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<style>
    .author-icon {
        cursor: pointer;
    }
    .author-icon-default {
        opacity: 1;
        transition: opacity 0.3s ease;
    }
    .author-image {
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    .author-icon:hover .author-icon-default {
        opacity: 0;
        transition-delay: 5s;
    }
    .author-icon:hover .author-image {
        opacity: 1;
        transition-delay: 5s;
    }
    .license-content {
        overflow: hidden;
        max-height: 0;
        opacity: 0;
        transition: max-height 0.3s ease, opacity 0.3s ease, padding 0.3s ease;
    }
    
    .license-content.expanded {
        max-height: 1000px;
        opacity: 1;
        display: block !important;
    }
    
    .license-chevron.expanded {
        transform: rotate(180deg);
    }

    /* Admin User Management Styles */
    .users-table-wrapper {
        width: 100%;
    }
    
    .users-table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .users-table-header h3 {
        margin: 0;
        color: var(--text-primary);
    }
    
    .users-table {
        overflow-x: auto;
        border-radius: 8px;
        border: 1px solid var(--border-color);
    }
    
    .users-table table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .users-table th,
    .users-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
    }
    
    .users-table th {
        background-color: var(--bg-secondary);
        font-weight: 600;
        color: var(--text-primary);
    }
    
    .users-table td {
        color: var(--text-secondary);
    }
    
    .users-table tr:hover {
        background-color: var(--bg-secondary);
    }
    
    .role-badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: 500;
        text-transform: uppercase;
    }
    
    .role-badge.admin-role {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--primary-color);
        border: 1px solid rgba(37, 99, 235, 0.2);
    }
    
    .role-badge.operator-role {
        background-color: rgba(16, 185, 129, 0.1);
        color: #10b981;
        border: 1px solid rgba(16, 185, 129, 0.2);
    }
    
    .role-badge.monitor-role {
        background-color: rgba(245, 158, 11, 0.1);
        color: #f59e0b;
        border: 1px solid rgba(245, 158, 11, 0.2);
    }
    
    .role-badge.viewer-role {
        background-color: rgba(107, 114, 128, 0.1);
        color: var(--text-secondary);
        border: 1px solid rgba(107, 114, 128, 0.2);
    }
    
    .role-badge.user-role {
        background-color: rgba(107, 114, 128, 0.1);
        color: var(--text-secondary);
        border: 1px solid rgba(107, 114, 128, 0.2);
    }
    
    .users-table .actions {
        white-space: nowrap;
    }
    
    .users-table .actions button {
        margin-right: 0.5rem;
    }
    
    .options_btn_small {
        padding: 4px 8px;
        font-size: 0.8rem;
    }
    
    .options_btn_danger {
        background-color: #dc2626;
        border-color: #dc2626;
    }
    
    .options_btn_danger:hover {
        background-color: #b91c1c;
        border-color: #b91c1c;
    }

    /* Admin Modal Styles */
    .admin-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }
    
    .admin-modal .modal-content {
        background-color: var(--bg-primary);
        border-radius: 8px;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }
    
    .admin-modal .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
    }
    
    .admin-modal .modal-title {
        margin: 0;
        color: var(--text-primary);
        font-size: 1.2rem;
    }
    
    .admin-modal .modal-close {
        background: none;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
    }
    
    .admin-modal .modal-close:hover {
        background-color: var(--bg-secondary);
        color: var(--text-primary);
    }
    
    .admin-modal .modal-body {
        padding: 1rem;
    }
    
    .modal-form-group {
        margin-bottom: 1rem;
    }
    
    .modal-form-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
        font-weight: 500;
    }
    
    .modal-form-group input {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        background-color: var(--bg-secondary);
        color: var(--text-primary);
    }
    
    .modal-form-group input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
    }
    
    .modal-form-group select {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        background-color: var(--bg-secondary);
        color: var(--text-primary);
    }
    
    .modal-form-group select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
    }
    
    .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 0.5rem;
        margin-top: 1rem;
    }
    
    .options_btn_secondary {
        background-color: var(--bg-secondary);
        color: var(--text-secondary);
        border-color: var(--border-color);
    }
    
    .options_btn_secondary:hover {
        background-color: var(--bg-primary);
        color: var(--text-primary);
        border-color: var(--text-secondary);
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const authorIcon = document.getElementById('authorIcon');
    const authorImage = document.getElementById('authorImage');
    let hoverTimer;

    fetch('/api/about/image')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                authorImage.src = data.data;
            }
        });

    authorImage.addEventListener('error', function() {
        authorImage.src = '';
    });

    authorIcon.addEventListener('mouseenter', () => {
        hoverTimer = setTimeout(() => {
            authorIcon.classList.add('show-image');
        }, 5000);
    });

    authorIcon.addEventListener('mouseleave', () => {
        clearTimeout(hoverTimer);
        authorIcon.classList.remove('show-image');
    });

    const licenseTrigger = document.getElementById('licenseTrigger');
    const licenseContent = document.getElementById('licenseContent');
    const licenseChevron = document.querySelector('.license-chevron');
    
    // Set initial state
    licenseContent.style.display = 'none';
    licenseContent.style.maxHeight = '0';
    licenseContent.style.opacity = '0';
    
    licenseTrigger.addEventListener('click', function() {
        licenseContent.classList.toggle('expanded');
        licenseChevron.classList.toggle('expanded');
        
        if (licenseContent.classList.contains('expanded')) {
            licenseContent.style.display = 'block';
            setTimeout(() => {
                licenseContent.style.maxHeight = licenseContent.scrollHeight + 'px';
                licenseContent.style.opacity = '1';
            }, 10);
        } else {
            licenseContent.style.maxHeight = '0';
            licenseContent.style.opacity = '0';
            setTimeout(() => {
                licenseContent.style.display = 'none';
            }, 300);
        }
    });
});
</script>

<style>
/* Tab content visibility */
.options_tab_content {
    display: block;
}

.options_tab_content.hidden {
    display: none !important;
}

/* Ensure tab content is visible when active */
.options_tab_content.active {
    display: block !important;
}

/* Hide tabs that user doesn't have permission to see */
.options_tab_button.hidden {
    display: none !important;
}
</style>

<script>
// Initialize tab visibility and set first available tab as active
document.addEventListener('DOMContentLoaded', function() {
    // Get all visible tab buttons
    const visibleTabButtons = document.querySelectorAll('.options_tab_button:not(.hidden)');
    const allTabButtons = document.querySelectorAll('.options_tab_button');
    const allTabContents = document.querySelectorAll('.options_tab_content');
    
    // Remove active class from all tabs
    allTabButtons.forEach(button => button.classList.remove('active'));
    allTabContents.forEach(content => content.classList.remove('active'));
    
    // Set first visible tab as active
    if (visibleTabButtons.length > 0) {
        const firstVisibleTab = visibleTabButtons[0];
        const tabId = firstVisibleTab.getAttribute('data-tab');
        
        // Set button as active
        firstVisibleTab.classList.add('active');
        
        // Set corresponding content as active
        const correspondingContent = document.getElementById(tabId + '_tab');
        if (correspondingContent) {
            correspondingContent.classList.add('active');
            correspondingContent.classList.remove('hidden');
        }
        
        console.log('🎯 First available tab activated:', tabId);
    }
    
    // Log available tabs for debugging
    const availableTabs = Array.from(visibleTabButtons).map(button => button.getAttribute('data-tab'));
    console.log('🔐 Available tabs for user:', availableTabs);
});
</script>

{% endblock %}  <!-- Chiusura del blocco content -->

{% block scripts %}
<script src="{{ url_for('static', filename='js/utils/notifications.js') }}"></script>
<script src="{{ url_for('static', filename='js/page_wrapper.js') }}"></script>
<script src="{{ url_for('static', filename='js/options_page.js') }}"></script>
<!-- Script import block for modular options page -->
<!-- Replace the single options_page.js script with these modular scripts -->
<script src="{{ url_for('static', filename='js/options/opt_core.js') }}"></script>
<script src="{{ url_for('static', filename='js/options/opt_email_form.js') }}"></script>
<script src="{{ url_for('static', filename='js/options/opt_email_providers.js') }}"></script>
<script src="{{ url_for('static', filename='js/options/opt_email_save.js') }}"></script>
<script src="{{ url_for('static', filename='js/options/opt_email_list.js') }}"></script>
<script src="{{ url_for('static', filename='js/options/opt_email_report.js') }}"></script>
<script src="{{ url_for('static', filename='js/options/opt_notification.js') }}"></script>
<script src="{{ url_for('static', filename='js/options/opt_system.js') }}"></script>
<script src="{{ url_for('static', filename='js/options/opt_database.js') }}"></script>
<script src="{{ url_for('static', filename='js/options/opt_logs.js') }}"></script>
<script src="{{ url_for('static', filename='js/options/opt_scheduler_init.js') }}"></script>
<script src="{{ url_for('static', filename='js/options/opt_scheduler_actions.js') }}"></script>
<script src="{{ url_for('static', filename='js/options/opt_polling.js') }}"></script>
<script src="{{ url_for('static', filename='js/options/opt_ntfy.js') }}"></script>
<script src="{{ url_for('static', filename='js/options/opt_webhook.js') }}"></script>
    <script src="{{ url_for('static', filename='js/options/opt_advanced.js') }}"></script>
    <script src="{{ url_for('static', filename='js/options/opt_initial_setup.js') }}"></script>
    <script src="{{ url_for('static', filename='js/options/opt_admin.js') }}"></script>
<script src="{{ url_for('static', filename='js/utils/restart_countdown.js') }}"></script>



<link rel="stylesheet" href="{{ url_for('static', filename='codemirror/lib/codemirror.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='codemirror/theme/monokai.css') }}">
<script src="{{ url_for('static', filename='codemirror/lib/codemirror.js') }}"></script>
<script src="{{ url_for('static', filename='codemirror/mode/shell/shell.js') }}"></script>

<!-- Advanced NUT Configuration styles moved to main.css -->
{% endblock %}  <!-- Chiusura del blocco scripts -->
